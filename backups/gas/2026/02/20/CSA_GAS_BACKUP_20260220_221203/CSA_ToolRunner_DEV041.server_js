/**
 * --------------------------------------------------------------------
 * @file_name: CSA_v1.1_ToolRunner.gs
 * @title: CSA ToolRunner (Canonical Operator Surface)
 * @product: CSA_v1.1 — Church Safety Alerts
 * @version: v1.1.5-DEV050
 * @binder_type: DEV Tooling (Non-runtime; Operator-controlled entrypoints)
 * @current_phase: DEV050 Consolidation Phase
 *
 * @thread_lineage:
 *   DEV041 → DEV042 → DEV048 → DEV049 → DEV050
 *
 * @last_updated: 2026-02-20 MST
 * @authors: Tim Caldwell → DEV050
 *
 * DEV050 Notes:
 * - OBI removed from ToolRunner.
 * - DEV046 scaffold not surfaced.
 * - Mode_DataInspect removed.
 * - Lowercase csa_* diagnostics consolidated here.
 * --------------------------------------------------------------------
 */

/* ============================================================
   SECTION 1 — Stable Checkpoint (DEV041)
============================================================ */

function RUN_DEV_CaptureStableCheckpointBaseline() {
  return CSA_CALL_IfExists_(
    'CSA_DEV041_CaptureStableCheckpointBaseline_',
    [],
    '[ToolRunner][DEV041][BASELINE]'
  );
}

function RUN_PROD_VerifyStableCheckpoint() {
  return CSA_CALL_IfExists_(
    'CSA_DEV041_VerifyStableCheckpoint_',
    [],
    '[ToolRunner][DEV041][VERIFY]'
  );
}

/* ============================================================
   SECTION 2 — DEV042 Reporting
============================================================ */

function RUN_DEV042_Dump_Props_And_Functions_REDACTED() {
  return CSA_CALL_IfExists_(
    'CSA_DEV042_BuildReadOnlyReport_',
    [{ redacted: true }],
    '[ToolRunner][DEV042][REPORT]'
  );
}

function RUN_DEV042_Dump_Props_And_Functions_RAW_NOT_FOR_BINDER() {
  return CSA_CALL_IfExists_(
    'CSA_DEV042_BuildReadOnlyReport_',
    [{ redacted: false }],
    '[ToolRunner][DEV042][REPORT][RAW]'
  );
}

/* ============================================================
   SECTION 3 — History (SAFE ONLY)
============================================================ */

function RUN_HISTORY_CreateProjectVersion() {
  Logger.log('[ToolRunner][HISTORY][VERSION] DISABLED — OBI removed for safety.');
  return { ok: false, reason: 'DISABLED_PENDING_SAFE_VERSIONING_IMPL' };
}

function RUN_HISTORY_BackupSourceToDrive() {
  return CSA_CALL_IfExists_(
    'CSA_Backup_GAS_Source_OnDemand',
    [],
    '[ToolRunner][HISTORY][BACKUP]'
  );
}

/* ============================================================
   SECTION 4 — GitHub (DEV049)
============================================================ */

function RUN_GITHUB_AuthTest_DEV049() {
  return CSA_CALL_IfExists_(
    'CSA_GitHub_Auth_Test_DEV049_',
    [],
    '[ToolRunner][GITHUB][AUTH]'
  );
}

function RUN_GITHUB_DiagnosePermissions_DEV049() {
  return CSA_CALL_IfExists_(
    'CSA_GitHub_DiagnosePermissions_DEV049_',
    [],
    '[ToolRunner][GITHUB][DIAG]'
  );
}

function RUN_GITHUB_PushLatestDriveSnapshot_DEV049() {
  return CSA_CALL_IfExists_(
    'CSA_GitHub_Push_Latest_GAS_Snapshot_To_GitHub_DEV049_',
    [],
    '[ToolRunner][GITHUB][PUSH]'
  );
}

/* ============================================================
   SECTION 5 — DEV049 UOD
============================================================ */

function RUN_DEV049_UOD_View_Full() {
  return CSA_CALL_IfExists_(
    'CSA_UOD_Query_',
    [{}],
    '[ToolRunner][DEV049][UOD][FULL]'
  );
}

function RUN_DEV049_UOD_Inspect_Debug() {
  var rows = CSA_UOD_Query_({});
  Logger.log('[ToolRunner][DEV049][UOD][DEBUG] Row Count: ' + rows.length);
  return { ok: true, row_count: rows.length };
}

/* ============================================================
   SECTION 6 — DEV050 Diagnostic Consolidation (Merged csa_*)
============================================================ */

function RUN_DEV050_E2E_WebApp_Probe() {
  return CSA_DEV050_E2E_WebApp_Probe_();
}

function RUN_DEV050_IncidentFlow_Debug() {
  return CSA_DEV050_IncidentFlow_Debug_();
}

function RUN_DEV050_DataBridge_RuntimeProbe() {
  return CSA_DEV050_DataBridge_RuntimeProbe_();
}

function RUN_DEV050_Probe_IncidentFlow() {
  return CSA_DEV050_Probe_IncidentFlow_();
}

/* ============================================================
   INTERNAL HELPER
============================================================ */

function CSA_CALL_IfExists_(fnName, args, logPrefix) {
  try {
    var fn = this[fnName];
    if (typeof fn !== 'function') {
      Logger.log((logPrefix || '[ToolRunner]') + ' Missing: ' + fnName);
      return { ok: false, reason: 'MISSING_FUNCTION', missing: fnName };
    }

    Logger.log((logPrefix || '[ToolRunner]') + ' Running: ' + fnName);
    var result = fn.apply(null, args || []);
    Logger.log((logPrefix || '[ToolRunner]') + ' Completed: ' + fnName);

    return { ok: true, function: fnName, result: result };

  } catch (e) {
    Logger.log((logPrefix || '[ToolRunner]') + ' ERROR in ' + fnName + ': ' + String(e));
    return { ok: false, reason: 'EXCEPTION', function: fnName, error: String(e) };
  }
}