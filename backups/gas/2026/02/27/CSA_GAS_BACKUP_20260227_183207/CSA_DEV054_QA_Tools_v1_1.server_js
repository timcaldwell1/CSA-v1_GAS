 /* 
 * --------------------------------------------------------------------
 * @file_name: CSA_DEV054_QA_Tools_v1_1.gs
 * @title: DEV054 QA Utilities — Clear test6_* (Safe Mode)
 * @product: CSA_v1.0 — Church Safety Alerts
 * @artifact_namespace: CSA_v1.1 (Documents & Code)
 * @version: v1.1-DEV054
 * @status: QA SUPPORT — SAFE CLEAR (keyword_defs preserved)
 * @create_date: 2026-02-27 MST
 * @last_updated: 2026-02-27 MST
 * @thread_lineage: DEV053 → DEV054
 * @authors: Tim Caldwell → DEV054
 *
 * Purpose:
 * - Clears test6_* operational sheets while preserving:
 *   - test6_cop_calls_raw
 *   - test6_keyword_defs
 *   - test6_safety_zones
 * - Preserves header row (row 1) in all cleared sheets.
 * --------------------------------------------------------------------
 */

function CSA_DEV054_Clear_Test6_Sheets_Safe_() {

  var prefix = 'test6_';
  var props = PropertiesService.getScriptProperties();
  var ssId = props.getProperty('CSA_SPREADSHEET_ID');

  if (!ssId) throw new Error('Missing CSA_SPREADSHEET_ID');

  var ss = SpreadsheetApp.openById(ssId);

  // Sheets to clear (data rows only, preserve header)
  var clearTargets = [
    prefix + 'poc_ingest_queue',
    prefix + 'incident_data',
    prefix + 'discarded_events',
    prefix + 'audit_log',
    prefix + 'error_log'
  ];

  var results = {};

  clearTargets.forEach(function(name) {

    var sh = ss.getSheetByName(name);
    if (!sh) {
      results[name] = 'NOT_FOUND';
      return;
    }

    var lastRow = sh.getLastRow();
    if (lastRow > 1) {
      sh.getRange(2, 1, lastRow - 1, sh.getLastColumn()).clearContent();
      results[name] = 'CLEARED_ROWS_2_TO_' + lastRow;
    } else {
      results[name] = 'NO_DATA';
    }

  });

  Logger.log('[DEV054][CLEAR][SAFE] %s', JSON.stringify(results));
  return results;
}